try{var C={arNum:4},swMarker=document.getElementById("swMarker"),swGyro=document.getElementById("swGyro"),swPreview=document.getElementById("swPreview"),swHelp=document.getElementById("swHelp"),helpContent=document.getElementById("helpContent");swHelp.addEventListener("click",function(){helpContent.classList.toggle("hide"),swHelp.classList.toggle("current")});for(var arg={},pair=location.search.substring(1).split("&"),i=0;pair[i];i++){var kv=pair[i].split("=");arg[kv[0]]=decodeURIComponent(kv[1])}var pad=new Array(C.arNum).join("0");arg.warpList=arg.fw&&(pad+parseInt(arg.fw,16).toString(2)).slice(-1*C.arNum).split("").reverse(),arg.shodowList=arg.fs&&(pad+parseInt(arg.fs,16).toString(2)).slice(-1*C.arNum).split("").reverse(),arg.poyoList=arg.fp&&(pad+parseInt(arg.fp,16).toString(2)).slice(-1*C.arNum).split("").reverse(),arg.decaList=arg.fd&&(pad+parseInt(arg.fd,16).toString(2)).slice(-1*C.arNum).split("").reverse(),arg.sizeList=arg.wh&&(pad+pad+parseInt(arg.wh,16).toString(10)).slice(-2*C.arNum).match(/.{2}/g).reverse();var arData=new Array(C.arNum+1).join("0").split("");if(!arData.some(function(t,e){return arg["i"+e]}))throw new Error("画像が取得できませんでした。");swMarker.addEventListener("click",function(){this.classList.contains("current")||(location.href=location.search.replace("&gyro=1","").replace("&preview=1",""))}),swGyro.addEventListener("click",function(){this.classList.contains("current")||(location.href=location.search.replace("&preview=1","")+"&gyro=1")}),swPreview.addEventListener("click",function(){this.classList.contains("current")||(location.href=location.search.replace("&gyro=1","")+"&preview=1")});var scene=document.querySelector("a-scene"),assets=document.createElement("a-assets");if(scene.addEventListener("click",function(t){if("a-enter-vr-button"===t.target.className){var e=document.querySelector("video");e.style.left="50%";var a=document.getElementById("leftlens"),r=a.getContext("2d");setInterval(function(){a.width=e.videoWidth,a.height=e.videoHeight,a.style.marginTop=e.style.marginTop,r.drawImage(e,0,0)},1e3/60)}}),arg.preview)(wrap=document.createElement("a-entity")).setAttribute("position","0 0 -15"),wrap.setAttribute("rotation","25 0 0"),swPreview.classList.add("current");else if(arg.gyro){(wrap=document.createElement("a-entity")).setAttribute("position","0 -5 -8");var camera=document.querySelector("a-camera-static");camera.setAttribute("look-controls","look-controls"),swGyro.classList.add("current")}else{var wrap;(wrap=document.createElement("a-marker")).setAttribute("preset","custom"),wrap.setAttribute("type","pattern"),wrap.setAttribute("url","asset/pattern-marker.patt"),swMarker.classList.add("current")}arData.forEach(function(t,e){if(arData[e]={path:arg["i"+e]},arData[e].isWarp=arg.warpList&&!!Number(arg.warpList[e]),arData[e].isShadow=arg.shodowList&&!!Number(arg.shodowList[e]),arData[e].isPoyo=arg.poyoList&&!!Number(arg.poyoList[e]),arData[e].isDeca=arg.decaList&&!!Number(arg.decaList[e]),arData[e].size=arg.sizeList?{w:.9*Number(arg.sizeList[e][0]),h:Number(arg.sizeList[e][1])}:{w:1.8,h:2},arData[e].isDeca&&(arData[e].size={w:10*arData[e].size.w,h:10*arData[e].size.h}),arData[e].isGif=!!(arg["i"+e]||"").match(/\.gif$/i),arg["i"+e]){var a=document.createElement("img");a.setAttribute("id","source"+e),a.setAttribute("src",arg["i"+e]),assets.appendChild(a),scene.appendChild(assets)}}),arData.forEach(function(t,e){if(t.path){var a=t.size.h/2;if(e&&t.isShadow){var r=document.createElement("a-entity"),i=[{x:0,y:0,z:0},{x:0,y:-.2,z:-arData[0].size.h/2-a},{x:0,y:-.1,z:-a},{x:0,y:0,z:arData[0].size.h/2-a}];if(r.setAttribute("position",AFRAME.utils.coordinates.stringify(i[e])),r.setAttribute("rotation","-90 0 0"),AFRAME.utils.entity.setComponentProperty(r,"geometry",{primitive:"plane",height:t.size.h,width:t.size.w}),AFRAME.utils.entity.setComponentProperty(r,"material",{shader:t.isGif?"gif":"standard",npot:!0,src:"#source"+e,color:"black",opacity:.3}),t.isPoyo){var s=document.createElement("a-animation");s.setAttribute("attribute","material.opacity"),s.setAttribute("direction","alternate"),s.setAttribute("dur","400"),s.setAttribute("to","0.1"),s.setAttribute("repeat","indefinite"),r.appendChild(s),(n=document.createElement("a-animation")).setAttribute("attribute","scale"),n.setAttribute("direction","alternate"),n.setAttribute("dur","400"),n.setAttribute("to","0.8 0.7 1"),n.setAttribute("easing","linear"),n.setAttribute("repeat","indefinite"),r.appendChild(n)}wrap.appendChild(r)}arData[e].main=document.createElement("a-entity");i=[{x:0,y:t.isWarp?a:0,z:0},{x:0,y:a,z:(t.isWarp?t.size.w:0)-arData[0].size.h/2},{x:0,y:a,z:-(t.isWarp?t.size.w:0)},{x:0,y:a,z:arData[0].size.h/2-(t.isWarp?t.size.w:0)}];if(arData[e].main.setAttribute("position",AFRAME.utils.coordinates.stringify(i[e])),arData[e].main.setAttribute("rotation",(0!==e||t.isWarp?0:-90)+" 0 0"),AFRAME.utils.entity.setComponentProperty(arData[e].main,"material",{shader:t.isGif?"gif":"standard",npot:!0,src:"#source"+e,side:"double",transparent:!0,alphaTest:.1}),AFRAME.utils.entity.setComponentProperty(arData[e].main,"geometry",{primitive:"plane",height:t.size.h,width:t.size.w}),t.isWarp)if(e){AFRAME.utils.entity.setComponentProperty(arData[e].main,"geometry",{primitive:"cylinder",openEnded:!0,thetaStart:[0,212,-32,-32][e],thetaLength:1===e?-64:64,height:t.size.h,radius:t.size.w})}else AFRAME.utils.entity.setComponentProperty(arData[e].main,"geometry",{primitive:"sphere",radius:a-.25,phiStart:-90});else AFRAME.utils.entity.setComponentProperty(arData[e].main,"geometry",{primitive:"plane",height:t.size.h,width:t.size.w});if(t.isPoyo){var n,o=document.createElement("a-animation");o.setAttribute("attribute","position"),o.setAttribute("direction","alternate"),o.setAttribute("dur","400"),o.setAttribute("to",i[e].x+" "+(i[e].y+t.size.h/4)+" "+i[e].z),o.setAttribute("repeat","indefinite"),arData[e].main.appendChild(o),(n=document.createElement("a-animation")).setAttribute("attribute","scale"),n.setAttribute("direction","alternate"),n.setAttribute("dur","400"),n.setAttribute("to","0.95 1.05 1"),n.setAttribute("easing","ease-out"),n.setAttribute("repeat","indefinite"),arData[e].main.appendChild(n)}else if(0===e&&t.isShadow){var p=document.createElement("a-animation");p.setAttribute("to",(t.isWarp?0:-90)+" 360 0"),p.setAttribute("dur","20000"),p.setAttribute("easing","linear"),p.setAttribute("fill","backwards"),p.setAttribute("repeat","indefinite"),arData[e].main.appendChild(p)}}}),arData[1].main&&wrap.appendChild(arData[1].main),arData[2].main&&wrap.appendChild(arData[2].main),arData[3].main&&wrap.appendChild(arData[3].main),arData[0].main&&wrap.appendChild(arData[0].main),scene.appendChild(wrap)}catch(t){"画像が取得できませんでした。"===t.message?window.confirm("画像情報が1つも取得できませんでした。\nジェネレータで再度QRコードを発行し直してください。")&&(location.href="https://web-ar-generator.firebaseapp.com/"):alert(t+"\n \n処理中にエラーが発生しました。\nいずれ修正しますので、また日を改めてご確認お願いします。\nエラーの出たマーカーとエラーのスクショを @yoridrill 宛にいただけると助かります。")}